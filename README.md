# Referal system

**Referal system** - Этот API предоставляет возможности для управления пользователями, включая регистрацию, получение токенов, доступ к профилю и обработку инвайт-кодов.

## Оглавление

- [Установка](#установка)
- [Использование](#использование)
  - [Регистрация](#регистрация)
  - [Получение одноразового кода для аутентификации](#получение-одноразового-кода-для-авторизации)
  - [Получение токена аутентификации](#получение-токена-авторизации)
  - [Страница профиля](#страница-профиля)
  - [Ввод инвайт-кода](#ввод-инвайт-кода)
  - [Документация](#документация)
  - [Логирование](#логирование)
- [Стек технологий](#стек-технологий)

---

## Установка

1. Клонируйте репозиторий:

```bash
    git clone git@github.com:monemonic/referal_system.git
    cd referal_system
```

2. Запустите docker-compose.yaml для запуска контейнеров

```bash
    docker compose -f docker-compose.yaml up -d
```
3. Примените миграции

```bash
  docker compose -f docker-compose.yaml exec backend_dev python manage.py migrate
```

## Использование

### Регистрация

`POST api/users/`

Регистрирует нового пользователя, если введены валидные данные, а именно номер телефона в формате +7 (999) 999-99-99

```json
  {
    "phone": "+7 (999) 999-99-99"
  }
```

### Получение одноразового кода для аутентификации

`POST api/users/code/`

Имитирует отправку одноразового четырехзначного кода, для последующего получения токена аутентификации. В данной реализации проверочный код всегда - 1111.

```json
  {
    "phone": "+7 (999) 999-99-99"
  }
```
Если пользователь заходит впервые и его номер телефона отсутвует в бд, то создает нового пользователя и так же отправляет одноразовый код для получения токена.
```json
  {
    "detail": "Код отправлен"
  }
```

### Получение токена аутентификации

`POST api/users/token/`

Создает токен аутентификации для пользователя с указанным номером телефона и верным одноразовым четырехзначным кодом. После получения токена код удаляется.

```json
  {
    "phone": "+7 (999) 999-99-99",
    "confirmation_code": 1111
  }
```

```json
  {
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjo1OTY2NjY3MzI1LCJpYXQiOjE3MzMwNjczMjUsImp0aSI6IjFhYWQ3ZjI0MTI3OTQ1Njg5M2MwM2QzN2Y4YzBkZmJmIiwidXNlcl9pZCI6Nn0.kJqXENzhHYuNqRXOywEmTwI-2wUSE5wbC5RGUxvygd8"
  }
```

### Страница профиля

`GET api/users/me/`

При запросе аутентифицированного пользователя запрос вернет данные его профиля.

```json
  {
    "phone": "+7 (919) 999-01-00",
    "invite_code": "jeve50",
    "inputed_invite_code": null,
    "invited_users": []
  }
```

Если пользователь вводил инвайт-код, то информация вернется в таком виде:

```json
  {
    "phone": "+7 (919) 999-01-00",
    "invite_code": "jeve50",
    "inputed_invite_code": "f5gh1Q",
    "invited_users": []
  }
```

Если инвайт-кодом пользователя пользовались другие пользователи, то ответ будет выглядеть вот так:

```json
  {
    "phone": "+7 (919) 999-01-00",
    "invite_code": "jeve50",
    "inputed_invite_code": null,
    "invited_users": [
        {
            "phone": "+7 (911) 999-01-00"
        }
    ]
  }
```

### Ввод инвайт-кода

`POST api/users/input_invite_code`
При запросе аутентифицированного пользователя с верным инвайт-кодом будет сохранена информация о том, что пользователь использовал инвайт-код конкретного пользователя. В его профиле появится информация о том, какой код был введен. Ему будет запрещено вводить новые инвайт-коды. Вводить собственный инвайт-код так же запрещено.

```json
  {
    "invite_code": "jeve50"
  }
```

При успешном запросе ответ будет следующим:

```json
  {
    "user": 7,
    "invite_code_owner": 6
  }
```

При попытке повторно ввести инвайт-код, вернется ошибка:

```json
  {
    "non_field_errors": [
        "Вы уже вводили инвайт-код"
    ]
  }
```

При попытке ввести собственный инвайт-код вернется ошибка:

```json
  {
    "non_field_errors": [
        "Нельзя вводить собственный инвайт-код"
    ]
  }
```

### Документация
`GET api/redoc/`

Запрос вернет страницу с документацией.


### Логирование
Так же в проекте реализовано логирование. Логи хранятся в файле query_logs.log


## Стек технологий

### Язык программирования:

- Python 3.13.0

### Бэкенд:

- Django REST Framework (DRF) 3.15.2
- Django 5.1.3
- Djangorestframework-simplejwt 5.3.1
- Djoser 2.3.1
- Gunicorn (для запуска приложения) 23.0.0

### Базы данных:
- PostgreSQL 17
- psycopg2-binary 2.9.10
- SQLite3

### Контейнеризация:

- Docker 27.0.3
- Docker Compose 3.8

### Веб-сервер:

- Nginx nginx:1.25.4-alpine

### Документация:

- Redoc (drf-yasg) 1.21.8